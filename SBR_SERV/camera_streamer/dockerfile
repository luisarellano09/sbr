FROM nvcr.io/nvidia/l4t-ml:r36.2.0-py3 as dev

RUN apt-get update -y
RUN apt-get install -y git cmake libpython3-dev python3-numpy
RUN apt-get install -y gstreamer1.0-tools gstreamer1.0-alsa gstreamer1.0-plugins-base gstreamer1.0-plugins-good gstreamer1.0-plugins-ugly gstreamer1.0-plugins-bad gstreamer1.0-libav libgstreamer-plugins-base1.0-dev
RUN apt-get install -y libsoup2.4-dev

WORKDIR /camera_streamer
RUN git clone --recursive --depth=1 https://github.com/dusty-nv/jetson-inference
RUN cd jetson-inference && mkdir build && cd build && cmake ../ && make -j$(nproc) && make install && ldconfig

RUN pip3 install pyrealsense2

RUN rm -rf src
COPY ./src ./src

CMD ["python3", "-u", "./src/main.py"]